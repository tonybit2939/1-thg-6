<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>01 tháng 06 Catty</title>
  <link rel="icon" type="image/png" href="image/favicon.ico">
  <link rel="stylesheet" href="./renxi/default.css">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: #fff;
    }

    #canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }

    #code {
      font-size: 4vw;
      line-height: 1.5;
      color: #000;
    }

    #code .say {
      display: block;
      margin-bottom: 1em;
    }

    #code img {
      max-width: 30vw;
      height: auto;
    }

    #clock-box {
      text-align: center;
      font-size: 4vw;
      margin-top: 20px;
    }

    #wrap {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 10;
      padding: 5vw;
      box-sizing: border-box;
    }

    #text {
      z-index: 20;
      position: relative;
    }

    #error {
      display: none;
      color: red;
      font-size: 4vw;
      text-align: center;
    }

    .hand {
      cursor: pointer;
    }
  </style>

  <script src="./renxi/jquery.min.js"></script>
  <script src="./renxi/jscex.min.js"></script>
  <script src="./renxi/jscex-parser.js"></script>
  <script src="./renxi/jscex-jit.js"></script>
  <script src="./renxi/jscex-builderbase.min.js"></script>
  <script src="./renxi/jscex-async.min.js"></script>
  <script src="./renxi/jscex-async-powerpack.min.js"></script>
  <script src="./renxi/functions.js"></script>
  <script src="./renxi/love.js"></script>
</head>

<body>

  <audio autoplay>
    <source src="music/nhac.mp3" type="audio/mp3" />
  </audio>

  <div id="main">
    <div id="error">Trình duyệt của bạn không được hỗ trợ. Hãy dùng Chrome hoặc Firefox.</div>
    <div id="wrap">
      <div id="text">
        <div id="code">
          <span class="say">Xin chào bà xã Catty của anh!!</span>
          <span class="say"> </span>
          <span class="say">Anh thật sự không có quá nhiều lời hoa mỹ để dành tặng cho em, nhưng chúc em 1-6 thật vui vẻ và ngập tràn những điều ngọt ngào.</span>
          <span class="say">Dù em không còn là trẻ con nữa nhưng bạn nhỏ Catty vẫn là em bé trong lòng anh, dù sau này có làm vợ anh, mẹ của con anh hay là bà của cháu chúng ta.</span>
          <span class="say">Thì ánh mắt, nụ cười ấy vẫn mãi là cô bé anh thương từ 16 tháng 03 năm 2025. </span>
          <span class="say"><img src="image/tym.png" alt=""></span>
          <span class="say">-- Tony của em --</span>
        </div>
      </div>

      <div id="clock-box">
        <div id="clock"></div>
      </div>

      <canvas id="canvas"></canvas>
    </div>
  </div>

  <script>
    (function(){
        const canvas = $('#canvas');
        if (!canvas[0].getContext) {
            $("#error").show();
            return;
        }

        const resizeCanvas = () => {
            const width = $(window).width();
            const height = $(window).height();
            canvas.attr("width", width);
            canvas.attr("height", height);
        };

        resizeCanvas();
        $(window).on('resize', resizeCanvas);

        const width = canvas.width();
        const height = canvas.height();

        const opts = {
            seed: {
                x: width / 2 - 20,
                color: "rgb(190, 26, 37)",
                scale: 2
            },
            branch: [
                [535, 680, 570, 250, 500, 200, 30, 100, [
                    [540, 500, 455, 417, 340, 400, 13, 100, [
                        [450, 435, 434, 430, 394, 395, 2, 40]
                    ]],
                    [550, 445, 600, 356, 680, 345, 12, 100, [
                        [578, 400, 648, 409, 661, 426, 3, 80]
                    ]],
                    [539, 281, 537, 248, 534, 217, 3, 40],
                    [546, 397, 413, 247, 328, 244, 9, 80, [
                        [427, 286, 383, 253, 371, 205, 2, 40],
                        [498, 345, 435, 315, 395, 330, 4, 60]
                    ]],
                    [546, 357, 608, 252, 678, 221, 6, 100, [
                        [590, 293, 646, 277, 648, 271, 2, 80]
                    ]]
                ]]
            ],
            bloom: {
                num: 700,
                width: width,
                height: height,
            },
            footer: {
                width: width,
                height: 5,
                speed: 10,
            }
        };

        const tree = new Tree(canvas[0], width, height, opts);
        const seed = tree.seed;
        const foot = tree.footer;
        let hold = 1;

        canvas.click(function(e) {
            const offset = canvas.offset();
            const x = e.pageX - offset.left;
            const y = e.pageY - offset.top;
            if (seed.hover(x, y)) {
                hold = 0;
                canvas.off("click");
                canvas.off("mousemove");
                canvas.removeClass('hand');
            }
        }).mousemove(function(e){
            const offset = canvas.offset();
            const x = e.pageX - offset.left;
            const y = e.pageY - offset.top;
            canvas.toggleClass('hand', seed.hover(x, y));
        });

        const seedAnimate = eval(Jscex.compile("async", function () {
            seed.draw();
            while (hold) {
                $await(Jscex.Async.sleep(10));
            }
            while (seed.canScale()) {
                seed.scale(0.95);
                $await(Jscex.Async.sleep(10));
            }
            while (seed.canMove()) {
                seed.move(0, 2);
                foot.draw();
                $await(Jscex.Async.sleep(10));
            }
        }));

        const growAnimate = eval(Jscex.compile("async", function () {
            do {
                tree.grow();
                $await(Jscex.Async.sleep(10));
            } while (tree.canGrow());
        }));

        const flowAnimate = eval(Jscex.compile("async", function () {
            do {
                tree.flower(2);
                $await(Jscex.Async.sleep(10));
            } while (tree.canFlower());
        }));

        const moveAnimate = eval(Jscex.compile("async", function () {
            tree.snapshot("p1", 240, 0, width, height);
            while (tree.move("p1", 500, 0)) {
                foot.draw();
                $await(Jscex.Async.sleep(10));
            }
            foot.draw();
            tree.snapshot("p2", 500, 0, width, height);
            canvas.parent().css("background", "url(" + tree.toDataURL('image/png') + ")");
            canvas.css("background", "#ffe");
            $await(Jscex.Async.sleep(300));
            canvas.css("background", "none");
        }));

        const jumpAnimate = eval(Jscex.compile("async", function () {
            while (true) {
                tree.ctx.clearRect(0, 0, width, height);
                tree.jump();
                foot.draw();
                $await(Jscex.Async.sleep(25));
            }
        }));

        const textAnimate = eval(Jscex.compile("async", function () {
            $("#code").show().typewriter();
            $("#clock-box").fadeIn(500);
            while (true) {
                $await(Jscex.Async.sleep(1000));
            }
        }));

        const runAsync = eval(Jscex.compile("async", function () {
            $await(seedAnimate());
            $await(growAnimate());
            $await(flowAnimate());
            $await(moveAnimate());
            textAnimate().start();
            $await(jumpAnimate());
        }));

        runAsync().start();
    })();
  </script>
</body>
</html>
